generator client {
  provider = "prisma-client"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ユーザーテーブル（Clerkと連携）
model User {
  id          String      @id @default(cuid())
  clerkId     String      @unique // ClerkのユーザーID
  email       String?     // Clerkから取得したメールアドレス
  role        String      @default("user") // "user" | "admin"
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  lastLoginAt DateTime?   // 最終ログイン日時
  
  profilePage ProfilePage? // 1ユーザー = 0または1プロフィール（任意）

  @@index([clerkId])
  @@map("users")
}

// プロフィールページテーブル
model ProfilePage {
  id              String     @id @default(cuid())
  userId          String      @unique // Userテーブルへの外部キー
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  slug            String      @unique // 公開URL用のスラッグ
  isPublished     Boolean     @default(false) // 公開状態
  
  // 基本情報（オンボーディング不要のため、エディターで入力）
  role            String?     // 役割・職業（自由入力）
  audience        String?     // 対象者（選択または自由入力）
  impressionTags  String[]    @default([]) // 印象タグ（最大3）
  
  // プロフィール情報
  name            String?     // 名前
  photoUrl        String?     // プロフィール写真URL（S3など）
  headline        String?     // 見出し
  tagline         String?     // タグライン
  
  // 詳細情報
  whoHelp         String?     // 誰を助けるか
  situation       String?     // どんな状況で頼まれるか
  reasonText      String?     // この仕事をしている理由
  valueText       String?     // 判断で大事にしていること
  notFitText      String?     // 向いていない人
  experienceTags  String[]    @default([]) // 経験・実績タグ（最大3）
  commonQuestions String[]    @default([]) // よくある質問（最大3）
  humanText       String?     // 最近考えていること
  
  // AI生成関連
  tone            String?     // トーン（logical | soft | flat）
  themeId         String?     // テーマID（T01〜T10）
  generatedJson   Json?       // AI生成されたJSON（見出し・本文など）
  
  // リレーション
  links           LinkItem[]  // リンク集（最大5件）
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@map("profile_pages")
}

// リンクアイテムテーブル
model LinkItem {
  id        String      @id @default(cuid())
  pageId    String      // ProfilePageへの外部キー
  page      ProfilePage @relation(fields: [pageId], references: [id], onDelete: Cascade)
  
  label     String      // リンクのラベル
  url       String      // リンクのURL
  order     Int         @default(0) // 表示順序（0-4、最大5件）
  
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@unique([pageId, order]) // 同じプロフィール内で順序は一意
  @@map("link_items")
}
